{#
  Cisco IOS ISIS Configuration Template

  Uses hybrid configuration inheritance:
  - Database fields for core parameters (metric, circuit type)
  - Config context for optional/vendor settings (BFD, auth, MPLS)

  Variables expected:
  - isis_config: ISISConfiguration object
  - interfaces: List of ISISInterfaceConfiguration objects
  - device_config_context: Pre-computed config context from device
#}
!
! ISIS Configuration for {{ isis_config.instance.device.name }}
!
router isis {{ isis_config.name }}
 net {{ isis_config.system_id }}
 is-type level-2-only
{%- if device_config_context.igp.isis.authentication is defined %}
{%- set auth = device_config_context.igp.isis.authentication %}
 authentication mode {{ auth.type }} {% if auth.level %}{{ auth.level }}{% endif %}
 authentication key-chain ISIS-KEY {% if auth.level %}{{ auth.level }}{% endif %}
{%- endif %}
{%- if device_config_context.igp.isis.cisco.metric_style is defined %}
 metric-style {{ device_config_context.igp.isis.cisco.metric_style }}
{%- else %}
 metric-style wide
{%- endif %}
 log-adjacency-changes
!
{% for interface_config in interfaces %}
{%- set effective = interface_config.get_effective_config() %}
{%- set cisco_config = interface_config.get_vendor_config('cisco') %}
!
interface {{ interface_config.interface.name }}
 description ISIS {{ isis_config.name }} - {{ effective.circuit_type }}
 ip router isis {{ isis_config.name }}
 isis circuit-type {{ effective.circuit_type|lower|replace('l1l2', 'level-1-2')|replace('l1', 'level-1')|replace('l2', 'level-2') }}
 isis metric {{ effective.metric }}
{%- if effective.hello_interval is defined %}
 isis hello-interval {{ effective.hello_interval }}
{%- endif %}
{%- if effective.hello_multiplier is defined %}
 isis hello-multiplier {{ effective.hello_multiplier }}
{%- endif %}
{%- if effective.priority is defined %}
 isis priority {{ effective.priority }}
{%- endif %}
{%- if cisco_config.bfd is defined and cisco_config.bfd.enabled %}
 isis bfd
{%- endif %}
{%- if cisco_config.mpls_traffic_eng %}
 isis mpls traffic-eng level-2
{%- endif %}
{%- if cisco_config.fast_reroute is defined %}
 isis fast-reroute per-prefix level-2 all
{%- endif %}
!
{% endfor %}
!
! End of ISIS configuration
!
